app-id: dev.askscience.cruise
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: cruise

finish-args:
  # Network access
  - --share=network
  
  # GUI access
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=fallback-x11
  
  # Audio access
  - --socket=pulseaudio
  
  # File system access (adjust as needed for your app)
  - --filesystem=home
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  - --filesystem=xdg-music
  
  # Device access (if needed for audio/video)
  - --device=all
  
  # System bus access (if needed)
  # - --system-talk-name=org.freedesktop.NetworkManager

modules:
  # Python runtime
  - name: python3
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps .
    sources:
      - type: archive
        url: https://www.python.org/ftp/python/3.9.18/Python-3.9.18.tar.xz
        sha256: d4de37fe8360e54c0d5d13f12d6d1eb1c8ff94e015d2f48d8c5c3e8c31f4f8f3

  # FFmpeg (for audio processing)
  - name: ffmpeg
    config-opts:
      - --enable-shared
      - --disable-static
      - --disable-doc
      - --disable-programs
      - --enable-libopus
      - --enable-libvorbis
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-6.0.tar.xz
        sha256: 57be87c22d9b49c112b6d24bc67d42508660e6b718b3db89c44e47e289137082

  # Your application
  - name: cruise
    buildsystem: simple
    build-commands:
      # Install Python dependencies
      - pip3 install --prefix=/app --no-deps -r requirements.txt
      
      # Copy application files
      - mkdir -p /app/lib/cruise
      - cp -r * /app/lib/cruise/
      
      # Create launcher script
      - |
        cat > /app/bin/cruise << 'EOF'
        #!/bin/bash
        cd /app/lib/cruise
        python3 launcher.py "$@"
        EOF
      - chmod +x /app/bin/cruise
      
      # Install desktop file and icon
      - install -Dm644 packaging/linux/dev.askscience.cruise.desktop /app/share/applications/dev.askscience.cruise.desktop
      - install -Dm644 packaging/linux/cruise-icon.png /app/share/icons/hicolor/256x256/apps/dev.askscience.cruise.png
    
    sources:
      - type: git
        url: https://github.com/askscience/cruise.git
        branch: master
